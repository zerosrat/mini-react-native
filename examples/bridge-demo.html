<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React Native Bridge é€šä¿¡æ¶æ„æ¼”ç¤º</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        
        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .demo-section h3 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .button:hover {
            background: #2980b9;
        }
        
        .output {
            background: #1a202c;
            color: #68d391;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .architecture-diagram {
            text-align: center;
            margin: 30px 0;
        }
        
        .layer {
            display: inline-block;
            width: 200px;
            padding: 15px;
            margin: 10px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
        }
        
        .js-layer { background: #f39c12; }
        .bridge-layer { background: #e74c3c; }
        .cpp-layer { background: #9b59b6; }
        .native-layer { background: #27ae60; }
        
        .arrow {
            font-size: 24px;
            color: #7f8c8d;
            margin: 0 10px;
        }
        
        .flow-diagram {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>React Native Bridge é€šä¿¡æ¶æ„æ¼”ç¤º</h1>
        <p>æ·±å…¥ç†è§£ JavaScript å’Œ Native ä»£ç ä¹‹é—´çš„é€šä¿¡æœºåˆ¶</p>
    </div>

    <div class="demo-section">
        <h3>ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ</h3>
        <div class="architecture-diagram">
            <div class="flow-diagram">
                <div class="layer js-layer">JavaScript Layer<br/>(React Native)</div>
                <div class="arrow">â†•</div>
                <div class="layer bridge-layer">JavaScript Bridge<br/>(MessageQueue)</div>
                <div class="arrow">â†•</div>
                <div class="layer cpp-layer">C++ Bridge Layer<br/>(JSCExecutor)</div>
                <div class="arrow">â†•</div>
                <div class="layer native-layer">Native Module<br/>(iOS/Android)</div>
            </div>
        </div>
        
        <h4>é€šä¿¡æµç¨‹</h4>
        <ol>
            <li><strong>JS â†’ Native è°ƒç”¨</strong>: JavaScript è°ƒç”¨ NativeModules.ModuleName.methodName()</li>
            <li><strong>æ¶ˆæ¯åºåˆ—åŒ–</strong>: Bridge å°†è°ƒç”¨ä¿¡æ¯åºåˆ—åŒ–ä¸º JSON</li>
            <li><strong>C++ ä¼ é€’</strong>: é€šè¿‡ C++ å±‚ä¼ é€’åˆ° Native ç«¯</li>
            <li><strong>Native æ‰§è¡Œ</strong>: Native ç«¯æ‰§è¡Œå¯¹åº”æ–¹æ³•</li>
            <li><strong>ç»“æœå›ä¼ </strong>: æ‰§è¡Œç»“æœé€šè¿‡ç›¸åŒè·¯å¾„å›ä¼ åˆ° JavaScript</li>
        </ol>
    </div>

    <div class="demo-section">
        <h3>ğŸ“± è®¾å¤‡ä¿¡æ¯è·å–æ¼”ç¤º</h3>
        <p>æ¼”ç¤ºå¦‚ä½•é€šè¿‡ Bridge è·å–è®¾å¤‡ä¿¡æ¯</p>
        
        <button class="button" onclick="getDeviceInfo()">è·å–è®¾å¤‡ä¿¡æ¯</button>
        <button class="button" onclick="getBatteryLevel()">è·å–ç”µæ± ç”µé‡</button>
        <button class="button" onclick="getNetworkState()">è·å–ç½‘ç»œçŠ¶æ€</button>
        
        <div class="code-block">
// JavaScript è°ƒç”¨ç¤ºä¾‹
const deviceId = await DeviceInfo.getDeviceId();
const batteryLevel = await DeviceInfo.getBatteryLevel();
const networkState = await DeviceInfo.getNetworkState();
        </div>
        
        <div id="device-output" class="output">ç‚¹å‡»æŒ‰é’®æŸ¥çœ‹è®¾å¤‡ä¿¡æ¯...</div>
    </div>

    <div class="demo-section">
        <h3>ğŸ’¾ å¼‚æ­¥å­˜å‚¨æ¼”ç¤º</h3>
        <p>æ¼”ç¤º Native å­˜å‚¨æ¨¡å—çš„ä½¿ç”¨</p>
        
        <input type="text" id="storage-key" placeholder="è¾“å…¥ key" style="padding: 8px; margin: 5px;">
        <input type="text" id="storage-value" placeholder="è¾“å…¥ value" style="padding: 8px; margin: 5px;">
        <br>
        <button class="button" onclick="setStorageItem()">å­˜å‚¨æ•°æ®</button>
        <button class="button" onclick="getStorageItem()">è¯»å–æ•°æ®</button>
        <button class="button" onclick="removeStorageItem()">åˆ é™¤æ•°æ®</button>
        <button class="button" onclick="getAllKeys()">è·å–æ‰€æœ‰ Key</button>
        
        <div class="code-block">
// å­˜å‚¨æ“ä½œç¤ºä¾‹
await AsyncStorage.setItem('user_name', 'React Native');
const userName = await AsyncStorage.getItem('user_name');
await AsyncStorage.removeItem('user_name');
        </div>
        
        <div id="storage-output" class="output">å­˜å‚¨æ“ä½œç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
    </div>

    <div class="demo-section">
        <h3>ğŸ”” äº‹ä»¶ç›‘å¬æ¼”ç¤º</h3>
        <p>æ¼”ç¤º Native åˆ° JavaScript çš„äº‹ä»¶æ¨é€</p>
        
        <button class="button" onclick="startBatteryMonitoring()">å¼€å§‹ç”µæ± ç›‘æ§</button>
        <button class="button" onclick="stopBatteryMonitoring()">åœæ­¢ç”µæ± ç›‘æ§</button>
        <button class="button" onclick="clearEventLog()">æ¸…ç©ºæ—¥å¿—</button>
        
        <div class="code-block">
// äº‹ä»¶ç›‘å¬ç¤ºä¾‹
bridge.addEventListener('batteryLevelChanged', (data) => {
    console.log('ç”µæ± ç”µé‡å˜åŒ–:', data);
});

await DeviceInfo.startBatteryMonitoring();
        </div>
        
        <div id="event-output" class="output">äº‹ä»¶æ—¥å¿—å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
    </div>

    <div class="demo-section">
        <h3>ğŸ”„ åŒå‘é€šä¿¡æ¼”ç¤º</h3>
        <p>æ¼”ç¤ºåˆ›å»ºè‡ªå®šä¹‰é€šä¿¡é€šé“</p>
        
        <button class="button" onclick="createChannel()">åˆ›å»ºé€šé“</button>
        <button class="button" onclick="sendMessage()">å‘é€æ¶ˆæ¯</button>
        <button class="button" onclick="closeChannel()">å…³é—­é€šé“</button>
        
        <div class="code-block">
// åŒå‘é€šä¿¡ç¤ºä¾‹
const channel = bridge.createChannel('dataSync');
channel.onMessage((data) => {
    console.log('æ”¶åˆ°æ¶ˆæ¯:', data);
});
channel.send({ message: 'Hello Native!' });
        </div>
        
        <div id="channel-output" class="output">é€šé“é€šä¿¡æ—¥å¿—å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
    </div>

    <div class="demo-section">
        <h3>ğŸ” è°ƒè¯•ä¿¡æ¯</h3>
        <p>æŸ¥çœ‹ Bridge å†…éƒ¨çŠ¶æ€å’Œè°ƒè¯•ä¿¡æ¯</p>
        
        <button class="button" onclick="getBridgeStatus()">è·å– Bridge çŠ¶æ€</button>
        <button class="button" onclick="getDebugInfo()">è·å–è°ƒè¯•ä¿¡æ¯</button>
        <button class="button" onclick="clearDebugLog()">æ¸…ç©ºè°ƒè¯•æ—¥å¿—</button>
        
        <div id="debug-output" class="output">è°ƒè¯•ä¿¡æ¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
    </div>

    <script>
        // æ¨¡æ‹Ÿ Bridge å¯¹è±¡ (åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™äº›ä¼šç”± Native å±‚æä¾›)
        const mockBridge = {
            isInitialized: true,
            eventListeners: {},
            channels: {},
            
            callNative: async function(module, method, args) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        // æ¨¡æ‹Ÿä¸åŒæ¨¡å—çš„å“åº”
                        if (module === 'DeviceInfo') {
                            switch (method) {
                                case 'getDeviceId':
                                    resolve('device-12345-abcde');
                                    break;
                                case 'getBatteryLevel':
                                    resolve({ level: 0.85, isCharging: false });
                                    break;
                                case 'getNetworkState':
                                    resolve({ type: 'wifi', isConnected: true });
                                    break;
                                default:
                                    resolve('Mock response for ' + method);
                            }
                        } else if (module === 'AsyncStorage') {
                            const storage = localStorage;
                            switch (method) {
                                case 'setItem':
                                    storage.setItem(args[0], args[1]);
                                    resolve(true);
                                    break;
                                case 'getItem':
                                    resolve(storage.getItem(args[0]));
                                    break;
                                case 'removeItem':
                                    storage.removeItem(args[0]);
                                    resolve(true);
                                    break;
                                case 'getAllKeys':
                                    resolve(Object.keys(storage));
                                    break;
                                default:
                                    resolve('Mock response for ' + method);
                            }
                        } else {
                            resolve('Mock response from ' + module + '.' + method);
                        }
                    }, Math.random() * 500 + 100);
                });
            },
            
            addEventListener: function(event, callback) {
                if (!this.eventListeners[event]) {
                    this.eventListeners[event] = [];
                }
                this.eventListeners[event].push(callback);
            },
            
            emit: function(event, data) {
                if (this.eventListeners[event]) {
                    this.eventListeners[event].forEach(callback => callback(data));
                }
            },
            
            createChannel: function(name) {
                const channel = {
                    name: name,
                    onMessage: function(callback) {
                        mockBridge.addEventListener('channel_' + name, callback);
                    },
                    send: function(data) {
                        logOutput('channel-output', `[å‘é€] ${JSON.stringify(data)}`);
                        // æ¨¡æ‹Ÿ Native å›å¤
                        setTimeout(() => {
                            mockBridge.emit('channel_' + name, {
                                type: 'reply',
                                message: 'Native received: ' + JSON.stringify(data),
                                timestamp: Date.now()
                            });
                        }, 200);
                    },
                    close: function() {
                        delete mockBridge.channels[name];
                        logOutput('channel-output', `[å…³é—­] é€šé“ ${name} å·²å…³é—­`);
                    }
                };
                this.channels[name] = channel;
                return channel;
            }
        };

        let currentChannel = null;
        let batteryMonitoringInterval = null;

        function logOutput(elementId, message) {
            const output = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }

        // è®¾å¤‡ä¿¡æ¯ç›¸å…³å‡½æ•°
        async function getDeviceInfo() {
            try {
                const deviceId = await mockBridge.callNative('DeviceInfo', 'getDeviceId', []);
                logOutput('device-output', `è®¾å¤‡ ID: ${deviceId}`);
            } catch (error) {
                logOutput('device-output', `é”™è¯¯: ${error.message}`);
            }
        }

        async function getBatteryLevel() {
            try {
                const battery = await mockBridge.callNative('DeviceInfo', 'getBatteryLevel', []);
                logOutput('device-output', `ç”µæ± ç”µé‡: ${JSON.stringify(battery)}`);
            } catch (error) {
                logOutput('device-output', `é”™è¯¯: ${error.message}`);
            }
        }

        async function getNetworkState() {
            try {
                const network = await mockBridge.callNative('DeviceInfo', 'getNetworkState', []);
                logOutput('device-output', `ç½‘ç»œçŠ¶æ€: ${JSON.stringify(network)}`);
            } catch (error) {
                logOutput('device-output', `é”™è¯¯: ${error.message}`);
            }
        }

        // å­˜å‚¨ç›¸å…³å‡½æ•°
        async function setStorageItem() {
            const key = document.getElementById('storage-key').value;
            const value = document.getElementById('storage-value').value;
            
            if (!key || !value) {
                logOutput('storage-output', 'è¯·è¾“å…¥ key å’Œ value');
                return;
            }
            
            try {
                await mockBridge.callNative('AsyncStorage', 'setItem', [key, value]);
                logOutput('storage-output', `å­˜å‚¨æˆåŠŸ: ${key} = ${value}`);
            } catch (error) {
                logOutput('storage-output', `å­˜å‚¨å¤±è´¥: ${error.message}`);
            }
        }

        async function getStorageItem() {
            const key = document.getElementById('storage-key').value;
            
            if (!key) {
                logOutput('storage-output', 'è¯·è¾“å…¥ key');
                return;
            }
            
            try {
                const value = await mockBridge.callNative('AsyncStorage', 'getItem', [key]);
                logOutput('storage-output', `è¯»å–ç»“æœ: ${key} = ${value || 'null'}`);
            } catch (error) {
                logOutput('storage-output', `è¯»å–å¤±è´¥: ${error.message}`);
            }
        }

        async function removeStorageItem() {
            const key = document.getElementById('storage-key').value;
            
            if (!key) {
                logOutput('storage-output', 'è¯·è¾“å…¥ key');
                return;
            }
            
            try {
                await mockBridge.callNative('AsyncStorage', 'removeItem', [key]);
                logOutput('storage-output', `åˆ é™¤æˆåŠŸ: ${key}`);
            } catch (error) {
                logOutput('storage-output', `åˆ é™¤å¤±è´¥: ${error.message}`);
            }
        }

        async function getAllKeys() {
            try {
                const keys = await mockBridge.callNative('AsyncStorage', 'getAllKeys', []);
                logOutput('storage-output', `æ‰€æœ‰ Key: ${JSON.stringify(keys)}`);
            } catch (error) {
                logOutput('storage-output', `è·å–å¤±è´¥: ${error.message}`);
            }
        }

        // äº‹ä»¶ç›‘å¬ç›¸å…³å‡½æ•°
        function startBatteryMonitoring() {
            if (batteryMonitoringInterval) {
                logOutput('event-output', 'ç”µæ± ç›‘æ§å·²åœ¨è¿è¡Œä¸­');
                return;
            }
            
            logOutput('event-output', 'å¼€å§‹ç”µæ± ç›‘æ§...');
            
            // ç›‘å¬ç”µæ± äº‹ä»¶
            mockBridge.addEventListener('batteryLevelChanged', (data) => {
                logOutput('event-output', `ç”µæ± äº‹ä»¶: ${JSON.stringify(data)}`);
            });
            
            // æ¨¡æ‹Ÿç”µæ± ç”µé‡å˜åŒ–
            batteryMonitoringInterval = setInterval(() => {
                const mockBatteryData = {
                    level: (Math.random() * 0.3 + 0.7).toFixed(2), // 70-100%
                    isCharging: Math.random() > 0.7,
                    timestamp: Date.now()
                };
                mockBridge.emit('batteryLevelChanged', mockBatteryData);
            }, 3000);
        }

        function stopBatteryMonitoring() {
            if (batteryMonitoringInterval) {
                clearInterval(batteryMonitoringInterval);
                batteryMonitoringInterval = null;
                logOutput('event-output', 'ç”µæ± ç›‘æ§å·²åœæ­¢');
            } else {
                logOutput('event-output', 'ç”µæ± ç›‘æ§æœªåœ¨è¿è¡Œ');
            }
        }

        function clearEventLog() {
            document.getElementById('event-output').textContent = '';
        }

        // åŒå‘é€šä¿¡ç›¸å…³å‡½æ•°
        function createChannel() {
            if (currentChannel) {
                logOutput('channel-output', 'é€šé“å·²å­˜åœ¨ï¼Œè¯·å…ˆå…³é—­å½“å‰é€šé“');
                return;
            }
            
            currentChannel = mockBridge.createChannel('demo-channel');
            
            currentChannel.onMessage((data) => {
                logOutput('channel-output', `[æ¥æ”¶] ${JSON.stringify(data)}`);
            });
            
            logOutput('channel-output', '[åˆ›å»º] é€šé“å·²åˆ›å»º');
        }

        function sendMessage() {
            if (!currentChannel) {
                logOutput('channel-output', 'è¯·å…ˆåˆ›å»ºé€šé“');
                return;
            }
            
            const message = {
                type: 'greeting',
                message: 'Hello from JavaScript!',
                timestamp: Date.now()
            };
            
            currentChannel.send(message);
        }

        function closeChannel() {
            if (currentChannel) {
                currentChannel.close();
                currentChannel = null;
            } else {
                logOutput('channel-output', 'æ²¡æœ‰æ‰“å¼€çš„é€šé“');
            }
        }

        // è°ƒè¯•ç›¸å…³å‡½æ•°
        function getBridgeStatus() {
            const status = {
                isInitialized: mockBridge.isInitialized,
                eventListeners: Object.keys(mockBridge.eventListeners),
                channels: Object.keys(mockBridge.channels)
            };
            logOutput('debug-output', `Bridge çŠ¶æ€: ${JSON.stringify(status, null, 2)}`);
        }

        function getDebugInfo() {
            const debugInfo = {
                timestamp: new Date().toISOString(),
                bridge: {
                    initialized: mockBridge.isInitialized,
                    eventListenerCount: Object.keys(mockBridge.eventListeners).length,
                    channelCount: Object.keys(mockBridge.channels).length
                },
                demo: {
                    batteryMonitoring: !!batteryMonitoringInterval,
                    currentChannel: currentChannel ? currentChannel.name : null
                }
            };
            logOutput('debug-output', `è°ƒè¯•ä¿¡æ¯: ${JSON.stringify(debugInfo, null, 2)}`);
        }

        function clearDebugLog() {
            document.getElementById('debug-output').textContent = '';
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            logOutput('debug-output', 'React Native Bridge æ¼”ç¤ºé¡µé¢å·²åŠ è½½');
            logOutput('debug-output', 'è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿæ¼”ç¤ºï¼Œå±•ç¤ºäº† Bridge çš„å„ç§åŠŸèƒ½');
        });
    </script>
</body>
</html>
